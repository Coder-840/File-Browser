<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTML File Runner</title>
<style>
body { font-family: sans-serif; padding: 2rem; }
#drop-area {
  border: 2px dashed #ccc;
  padding: 2rem;
  text-align: center;
  margin-bottom: 1rem;
  transition: background 0.2s;
}
</style>
</head>
<body>
<h2>Upload and Run HTML File (Max 100MB)</h2>

<div id="drop-area">
  Drag & Drop your HTML file here<br>or<br>
  <input type="file" id="fileElem" accept=".html" />
</div>

<div id="progress"></div>

<script>
const dropArea = document.getElementById("drop-area");
const fileElem = document.getElementById("fileElem");
const progress = document.getElementById("progress");

function uploadFile(file) {
  const formData = new FormData();
  formData.append("file", file);

  const xhr = new XMLHttpRequest();
  xhr.open("POST", "/upload", true);
  xhr.responseType = "json"; // crucial!

  xhr.upload.onprogress = e => {
    if (e.lengthComputable) {
      progress.textContent = `Uploading: ${Math.round((e.loaded / e.total) * 100)}%`;
    }
  };

  xhr.onload = () => {
    if (xhr.status === 200 && xhr.response && xhr.response.url) {
      progress.textContent = "Upload complete!";
      // Open the uploaded HTML in a new tab
      window.open(xhr.response.url, "_blank");
    } else if (xhr.response && xhr.response.error) {
      progress.textContent = `Upload failed: ${xhr.response.error}`;
    } else {
      progress.textContent = "Upload failed: unknown error";
    }
  };

  xhr.onerror = () => {
    progress.textContent = "Upload failed: network error";
  };

  xhr.send(formData);
}

dropArea.addEventListener("dragover", e => { e.preventDefault(); dropArea.style.background = "#f0f0f0"; });
dropArea.addEventListener("dragleave", e => { e.preventDefault(); dropArea.style.background = ""; });
dropArea.addEventListener("drop", e => { e.preventDefault(); dropArea.style.background = ""; if(e.dataTransfer.files.length) uploadFile(e.dataTransfer.files[0]); });
fileElem.addEventListener("change", e => { if(fileElem.files.length) uploadFile(fileElem.files[0]); });
</script>
</body>
</html>
